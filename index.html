<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Catálogo de Eletrônicos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- INÍCIO DO CSS --- */
        /* Variáveis CSS */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        :root,
        body:not(.dark-mode) {
            --primary-blue: #1877F2;
            --background-gray: #f0f2f5;
            --card-background: #ffffff;
            --text-primary: #050505;
            --text-secondary: #65676b;
            --border-color: #ced0d4;
            --green-stock: #31a24c;
            --orange-stock: #f7b928;
            --red-stock: #f02849;
            --button-green: #28a745;
            --button-red: #dc3545;
            --button-hover: #0056b3;
            --toast-background: #333;
            --toast-text: #ffffff;
            --modal-overlay: rgba(0, 0, 0, 0.7);
            --scrollbar-thumb: #c1c1c1;
            --scrollbar-track: var(--background-gray);
            --transition-speed: 0.3s;
        }

        body.dark-mode {
            --primary-blue: #1877F2;
            --background-gray: #18191a;
            --card-background: #242526;
            --text-primary: #e4e6eb;
            --text-secondary: #b0b3b8;
            --border-color: #3a3b3c;
            --green-stock: #31a24c;
            --orange-stock: #f7b928;
            --red-stock: #f02849;
            --button-green: #28a745;
            --button-red: #dc3545;
            --button-hover: #3b8bf4;
            --toast-background: #e4e6eb;
            --toast-text: #1c1e21;
            --modal-overlay: rgba(0, 0, 0, 0.8);
            --scrollbar-thumb: #555;
            --scrollbar-track: var(--background-gray);
            --transition-speed: 0.3s;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            width: 100%;
            background-color: var(--background-gray);
            color: var(--text-primary);
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            -ms-content-zooming: none;
            touch-action: manipulation;
        }

        header {
            background-color: var(--card-background);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            height: 56px;
            justify-content: space-between;
        }

        header h1 {
            font-size: 1.5em;
            margin: 0;
            font-weight: 700;
        }

        #search-input {
            border: none;
            background-color: var(--background-gray);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 1em;
            flex-grow: 1;
            max-width: 400px;
            margin: 0 15px;
            color: var(--text-primary);
        }

        .cart-icon-container {
            position: relative;
            cursor: pointer;
        }

        #animated-cart-icon {
            font-size: 1.8em;
            color: var(--primary-blue);
            transition: transform 0.2s ease-in-out;
        }

        #animated-cart-icon.pulse {
            animation: pulse-cart 0.5s ease-out;
        }

        @keyframes pulse-cart {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.15) rotate(10deg);
            }

            100% {
                transform: scale(1);
            }
        }

        #cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--red-stock);
            color: white;
            font-size: 0.7em;
            font-weight: bold;
            border-radius: 50%;
            padding: 2px 6px;
            min-width: 15px;
            text-align: center;
        }

        .settings-icon {
            font-size: 1.8em;
            color: var(--text-primary);
            cursor: pointer;
            margin-right: 15px;
        }

        .settings-section {
            padding: 20px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .sidebar-section .options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .display-options-modal {
            display: flex;
            gap: 10px;
        }

        .display-option-btn {
            background-color: var(--background-gray);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            flex-grow: 1;
        }

        .display-option-btn:hover {
            background-color: var(--border-color);
        }

        .display-option-btn.active {
            background-color: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .settings-section h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
            background-color: #87CEEB;
            border-radius: 25px;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease;
            overflow: hidden;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch .fas {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 15px;
            transition: transform var(--transition-speed) ease, opacity var(--transition-speed) ease;
        }

        .switch .fa-sun {
            left: 5px;
            color: #f1c40f;
            opacity: 1;
            transform: translateY(-50%) translateX(0%);
        }

        .switch .fa-moon {
            right: 5px;
            color: #f0e68c;
            opacity: 0;
            transform: translateY(-50%) translateX(100%);
        }

        body.dark-mode .switch {
            background-color: #483D8B;
        }

        .switch input:checked~.fa-sun {
            opacity: 0;
            transform: translateY(-50%) translateX(-120%);
        }

        .switch input:checked~.fa-moon {
            opacity: 1;
            transform: translateY(-50%) translateX(0%);
        }

        main {
            padding: 8px;
            padding-top: calc(56px + 8px);
            transition: margin-left var(--transition-speed) ease;
        }

        .product-container {
            display: grid;
            gap: 8px;
            padding-bottom: 20px;
        }

        .product-container.grid-view {
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        }

        @media (min-width: 600px) {
            .product-container.grid-view {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        .product-container.list-view {
            grid-template-columns: 1fr;
        }

        .product-card.grid-item {
            background-color: var(--card-background);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: box-shadow 0.2s ease;
        }

        .product-card.grid-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .product-card.grid-item .image-container {
            position: relative;
            width: 100%;
            padding-top: 100%;
        }

        .product-card.grid-item img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-card.grid-item .info {
            padding: 12px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-card.list-item {
            background-color: var(--card-background);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: box-shadow 0.2s ease;
        }

        .product-card.list-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .product-card.list-item .image-container {
            width: 80px;
            height: 80px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .product-card.list-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .product-card.list-item .info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .product-card .price {
            font-size: 1.1em;
            font-weight: 700;
            margin: 0 0 4px 0;
            color: var(--text-primary);
        }

        .product-card .name {
            font-size: 0.95em;
            margin: 0;
            flex-grow: 1;
            line-height: 1.3;
            color: var(--text-secondary);
        }

        .product-card.list-item .name {
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .product-card .stock {
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 8px;
            padding: 3px 6px;
            border-radius: 4px;
            text-align: center;
            align-self: flex-start;
        }

        .product-card.list-item .stock {
            margin-top: 0;
        }

        .stock.high {
            background-color: var(--green-stock);
            color: white;
        }

        .stock.low {
            background-color: var(--orange-stock);
            color: white;
        }

        .stock.out {
            background-color: var(--red-stock);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-background);
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: slideUp var(--transition-speed) ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h2 {
            margin-top: 0;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            transition: color var(--transition-speed) ease, border-color var(--transition-speed) ease;
            padding-bottom: 10px;
        }

        #settings-modal .modal-content {
            max-width: 400px;
        }

        .close-button {
            color: var(--text-secondary);
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
            transition: color var(--transition-speed) ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--text-primary);
            text-decoration: none;
            cursor: pointer;
        }

        #product-modal .modal-content {
            max-width: 500px;
            border-radius: 12px;
            padding: 0;
        }

        #product-modal .close-button {
            color: #fff;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            top: 15px;
            right: 15px;
            z-index: 10;
        }

        #modal-image-slider {
            position: relative;
            width: 100%;
            padding-top: 75%;
            overflow: hidden;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        #modal-image-slider .slider-images {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            transition: transform 0.5s ease-in-out;
        }

        #modal-image-slider .slider-images img {
            min-width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #000;
        }

        .slider-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            font-size: 24px;
            padding: 8px 12px;
            cursor: pointer;
            z-index: 10;
        }

        .slider-btn.prev {
            left: 10px;
        }

        .slider-btn.next {
            right: 10px;
        }

        .slider-btn:disabled {
            opacity: 0.3;
            cursor: default;
        }

        .slider-indicators {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .indicator-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--border-color);
            cursor: pointer;
            transition: background-color var(--transition-speed) ease;
        }

        .indicator-dot.active {
            background-color: var(--primary-blue);
        }

        #modal-details {
            padding: 20px;
        }

        #modal-price {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-primary);
        }

        #modal-name {
            font-size: 1.2em;
            margin: 8px 0;
            color: var(--text-primary);
        }

        #modal-stock {
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 16px;
            padding: 3px 6px;
            border-radius: 4px;
            color: white;
            display: inline-block;
            text-align: center;
            align-self: flex-start;
        }

        #modal-description {
            font-size: 1em;
            line-height: 1.5;
            color: var(--text-secondary);
            white-space: pre-wrap;
        }

        .add-to-cart-btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
            transition: background-color var(--transition-speed) ease;
        }

        .add-to-cart-btn:hover {
            background-color: var(--button-hover);
        }

        .add-to-cart-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        #cart-modal .modal-content h2 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        #cart-items {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .cart-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .cart-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .cart-item-details {
            flex-grow: 1;
        }

        .cart-item-details .name {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-primary);
        }

        .cart-item-details .price {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
            flex-shrink: 0;
        }

        .cart-item-controls button {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .cart-item-controls button:hover {
            background-color: var(--button-hover);
        }

        .cart-item-controls span {
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }

        #empty-cart-message {
            text-align: center;
            color: var(--text-secondary);
            padding: 20px;
        }

        #cart-summary {
            margin-top: 20px;
            padding-top: 15px;
            background-color: var(--card-background);
            border-top: 1px solid var(--border-color);
            text-align: right;
        }

        #cart-summary h3 {
            margin: 0;
            font-size: 1.5em;
            color: var(--text-primary);
        }

        #cart-total {
            color: var(--primary-blue);
        }

        .clear-cart-btn {
            background-color: var(--button-red);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color var(--transition-speed) ease;
        }

        .clear-cart-btn:hover {
            background-color: #c82333;
        }

        #toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1003;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background-color: var(--toast-background);
            color: var(--toast-text);
            padding: 12px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInOut 3s forwards;
            min-width: 250px;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.error {
            background-color: var(--red-stock);
            color: white;
        }

        .toast i {
            font-size: 1.2em;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            10% {
                opacity: 1;
                transform: translateY(0);
            }

            90% {
                opacity: 1;
                transform: translateY(0);
            }

            100% {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        body::-webkit-scrollbar {
            width: 8px;
        }

        body::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
        }

        body::-webkit-scrollbar-thumb {
            background-color: var(--scrollbar-thumb);
            border-radius: 10px;
        }

        /* --- FIM DO CSS --- */
    </style>
</head>

<body>
    <header>
        <div class="settings-icon" id="settings-icon">
            <i class="fas fa-cog"></i>
        </div>
        <input type="text" placeholder="Buscar no catálogo..." id="search-input">
        <div class="cart-icon-container">
            <i class="fas fa-shopping-cart" id="animated-cart-icon"></i>
            <span id="cart-count">0</span>
        </div>
    </header>

    <main>
        <div id="product-grid" class="product-container grid-view">
            <div id="loader">Carregando produtos...</div>
        </div>
    </main>

    <div id="product-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-product-modal">&times;</span>
            <div id="modal-image-slider">
                <button class="slider-btn prev" id="modal-prev-btn">&#10094;</button>
                <div class="slider-images" id="slider-images"></div>
                <div class="slider-indicators" id="modal-image-indicators"></div>
                <button class="slider-btn next" id="modal-next-btn">&#10095;</button>
            </div>
            <div id="modal-details">
                <div id="modal-price"></div>
                <div id="modal-name"></div>
                <div id="modal-stock"></div>
                <p id="modal-description"></p>
                <button id="add-to-cart-button" class="add-to-cart-btn">Adicionar ao Carrinho</button>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-cart-modal">&times;</span>
            <h2>Seu Carrinho</h2>
            <div id="cart-items">
                <p id="empty-cart-message">Seu carrinho está vazio.</p>
            </div>
            <div id="cart-summary">
                <h3>Total: <span id="cart-total">R$ 0,00</span></h3>
                <button id="clear-cart-button" class="clear-cart-btn">Limpar Carrinho</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-settings-modal">&times;</span>
            <h2>Configurações</h2>
            <div class="settings-section">
                <h4>Modo de Exibição</h4>
                <div class="display-options-modal">
                    <button id="display-grid-button" class="display-option-btn active">
                        <i class="fas fa-th"></i> Grade
                    </button>
                    <button id="display-list-button" class="display-option-btn">
                        <i class="fas fa-list"></i> Lista
                    </button>
                </div>
            </div>
            <div class="settings-section">
                <h4>Tema</h4>
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <i class="fas fa-sun"></i>
                    <i class="fas fa-moon"></i>
                </label>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elementos do DOM ---
            const productGrid = document.getElementById('product-grid');
            const loader = document.getElementById('loader');
            const searchInput = document.getElementById('search-input');
            const animatedCartIcon = document.getElementById('animated-cart-icon');
            const cartCountSpan = document.getElementById('cart-count');
            const toastContainer = document.getElementById('toast-container');

            // Modais
            const productModal = document.getElementById('product-modal');
            const closeProductModalBtn = document.getElementById('close-product-modal');
            const modalImageSlider = document.getElementById('modal-image-slider');
            const sliderImagesContainer = document.getElementById('slider-images');
            const modalPrevBtn = document.getElementById('modal-prev-btn');
            const modalImageIndicators = document.getElementById('modal-image-indicators');
            const modalNextBtn = document.getElementById('modal-next-btn');
            const modalPrice = document.getElementById('modal-price');
            const modalName = document.getElementById('modal-name');
            const modalStock = document.getElementById('modal-stock');
            const modalDescription = document.getElementById('modal-description');
            const addToCartButton = document.getElementById('add-to-cart-button');

            const cartModal = document.getElementById('cart-modal');
            const closeCartModalBtn = document.getElementById('close-cart-modal');
            const cartItemsContainer = document.getElementById('cart-items');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const cartTotalSpan = document.getElementById('cart-total');
            const clearCartButton = document.getElementById('clear-cart-button');

            // Ícone de Configurações e Modal de Configurações
            const settingsIcon = document.getElementById('settings-icon');
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsModalBtn = document.getElementById('close-settings-modal');

            // Opções de Exibição (dentro do modal de configurações)
            const displayGridButton = document.getElementById('display-grid-button');
            const displayListButton = document.getElementById('display-list-button');
            const darkModeToggle = document.getElementById('dark-mode-toggle');

            // --- Estado da Aplicação ---
            let allProducts = [];
            let currentCart = [];
            let selectedProduct = null;
            let currentImageIndex = 0; // Para o slider de imagens do modal
            let currentViewMode = 'grid'; // 'grid' ou 'list'
            // Variáveis para controle do swipe no modal
            let touchStartX = 0;
            let touchEndX = 0;
            const swipeThreshold = 50; // Mínimo de pixels para considerar um swipe

            // --- Funções de Ajuda ---

            /**
             * Exibe uma notificação toast.
             * @param {string} message - A mensagem a ser exibida.
             * @param {string} type - O tipo de toast ('success' ou 'error').
             */
            function showToast(message, type = 'success') {
                if (!toastContainer) return;
                const toast = document.createElement('div');
                toast.classList.add('toast', type);
                toast.innerHTML = `
            <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i>
            <span>${message}</span>
        `;
                toastContainer.appendChild(toast);

                // Força o reflow para a animação CSS funcionar
                void toast.offsetWidth;

                setTimeout(() => {
                    toast.remove();
                }, 3000); // Remove o toast após 3 segundos
            }

            /**
             * Anima o ícone do carrinho.
             */
            function animateCartIcon() {
                if (!animatedCartIcon) return;
                animatedCartIcon.classList.add('pulse');
                setTimeout(() => {
                    animatedCartIcon.classList.remove('pulse');
                }, 500);
            }

            /**
             * Retorna o status de estoque formatado.
             * @param {number} stock
             * @returns {{text: string, className: string}}
             */
            function getStockStatus(stock) {
                if (isNaN(stock) || stock === 0) {
                    return { text: 'Esgotado', className: 'out' };
                } else if (stock <= 5) {
                    return { text: `${stock} em estoque`, className: 'low' };
                } else {
                    return { text: 'Em estoque', className: 'high' };
                }
            }

            // --- Funções de Renderização ---

            /**
             * Renderiza um único card de produto.
             * @param {Object} product - O objeto produto.
             * @param {string} viewMode - 'grid' ou 'list'.
             * @returns {HTMLElement} O elemento HTML do card.
             */
            function renderProductCard(product, viewMode) {
                const card = document.createElement('div');
                card.classList.add('product-card', viewMode === 'grid' ? 'grid-item' : 'list-item');
                card.dataset.productId = product.id; // Armazena o ID do produto no elemento

                const firstImage = product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/200/cccccc/ffffff?text=Sem+Imagem';
                const stockStatus = getStockStatus(product.stock);

                card.innerHTML = `
            <div class="image-container">
                <img src="${firstImage}" alt="${product.name}" loading="lazy">
            </div>
            <div class="info">
                <p class="price">R$ ${product.price ? product.price.toFixed(2).replace('.', ',') : 'N/A'}</p>
                <p class="name">${product.name || 'Produto sem nome'}</p>
                <div class="stock ${stockStatus.className}">${stockStatus.text}</div>
            </div>
        `;

                card.addEventListener('click', () => openProductModal(product));
                return card;
            }

            /**
             * Renderiza todos os produtos na grade/lista.
             * @param {Array} productsToDisplay - Array de produtos filtrados.
             */
            function renderProducts(productsToDisplay) {
                if (!productGrid) return;
                productGrid.innerHTML = ''; // Limpa o conteúdo atual
                if (productsToDisplay.length === 0) {
                    productGrid.innerHTML = '<p>Nenhum produto encontrado.</p>';
                } else {
                    productsToDisplay.forEach(product => {
                        if (product) productGrid.appendChild(renderProductCard(product, currentViewMode));
                    });
                }
                // Atualiza as classes do container para o modo de visualização
                productGrid.classList.remove('grid-view', 'list-view');
                productGrid.classList.add(`${currentViewMode}-view`);
            }

            /**
             * Renderiza o carrinho de compras.
             */
            function renderCart() {
                if (!cartItemsContainer || !emptyCartMessage || !clearCartButton || !cartTotalSpan || !cartCountSpan) return;

                cartItemsContainer.innerHTML = ''; // Limpa o conteúdo atual

                if (currentCart.length === 0) {
                    emptyCartMessage.style.display = 'block';
                    clearCartButton.style.display = 'none'; // Esconde o botão de limpar carrinho
                } else {
                    emptyCartMessage.style.display = 'none';
                    clearCartButton.style.display = 'block'; // Mostra o botão de limpar carrinho
                    currentCart.forEach(item => {
                        const cartItemDiv = document.createElement('div');
                        cartItemDiv.classList.add('cart-item');
                        const itemImage = item.product.images && item.product.images.length > 0 ? item.product.images[0] : 'https://via.placeholder.com/60/cccccc/ffffff?text=';
                        cartItemDiv.innerHTML = `
                    <img src="${itemImage}" alt="${item.product.name}">
                    <div class="cart-item-details">
                        <div class="name">${item.product.name}</div>
                        <div class="price">R$ ${item.product.price.toFixed(2).replace('.', ',')} x ${item.quantity}</div>
                    </div>
                    <div class="cart-item-controls">
                        <button class="decrease-quantity" data-product-id="${item.product.id}">-</button>
                        <span>${item.quantity}</span>
                        <button class="increase-quantity" data-product-id="${item.product.id}">+</button>
                    </div>
                `;
                        cartItemsContainer.appendChild(cartItemDiv);

                        cartItemDiv.querySelector('.decrease-quantity').addEventListener('click', () => updateItemQuantity(item.product.id, -1));
                        cartItemDiv.querySelector('.increase-quantity').addEventListener('click', () => updateItemQuantity(item.product.id, 1));
                    });
                }

                const total = currentCart.reduce((sum, item) => sum + (item.product.price * item.quantity), 0);
                cartTotalSpan.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
                cartCountSpan.textContent = currentCart.reduce((sum, item) => sum + item.quantity, 0);
            }

            // --- Funções do Carrinho ---

            /**
             * Adiciona um produto ao carrinho.
             * @param {Object} productToAdd - O produto a ser adicionado.
             */
            function addItemToCart(productToAdd) {
                if (!productToAdd || typeof productToAdd.id === 'undefined') {
                    console.error("Tentativa de adicionar produto inválido ao carrinho:", productToAdd);
                    showToast('Erro ao adicionar produto ao carrinho.', 'error');
                    return;
                }
                const existingItem = currentCart.find(item => item.product.id === productToAdd.id);

                if (existingItem) {
                    if (existingItem.quantity < productToAdd.stock) {
                        existingItem.quantity++;
                        showToast(`${productToAdd.name} +1 no carrinho!`);
                    } else {
                        showToast(`Não há mais estoque de ${productToAdd.name}.`, 'error');
                    }
                } else {
                    currentCart.push({ product: productToAdd, quantity: 1 });
                    showToast(`${productToAdd.name} adicionado ao carrinho!`);
                }
                animateCartIcon();
                renderCart();
                saveCartToLocalStorage();
            }

            /**
             * Atualiza a quantidade de um item no carrinho.
             * @param {string} productId - ID do produto.
             * @param {number} change - Mudança na quantidade (+1 ou -1).
             */
            function updateItemQuantity(productId, change) {
                const itemIndex = currentCart.findIndex(item => item.product.id === productId);

                if (itemIndex > -1) {
                    const item = currentCart[itemIndex];
                    const newQuantity = item.quantity + change;

                    if (newQuantity > 0 && newQuantity <= item.product.stock) {
                        item.quantity = newQuantity;
                        showToast(`Quantidade de ${item.product.name} atualizada para ${newQuantity}.`);
                    } else if (newQuantity <= 0) {
                        if (confirm(`Remover ${item.product.name} do carrinho?`)) {
                            currentCart.splice(itemIndex, 1);
                            showToast(`${item.product.name} removido do carrinho.`, 'success');
                        }
                    } else if (newQuantity > item.product.stock) {
                        showToast(`Você atingiu o limite de estoque para ${item.product.name}.`, 'error');
                    }
                }
                renderCart();
                saveCartToLocalStorage();
            }

            /**
             * Limpa todo o carrinho.
             */
            function clearCart() {
                if (confirm('Tem certeza que deseja limpar o carrinho?')) {
                    currentCart = [];
                    showToast('Carrinho limpo!', 'success');
                    renderCart();
                    saveCartToLocalStorage();
                }
            }

            // --- Funções de Modal ---

            /**
             * Abre o modal de detalhes do produto.
             * @param {Object} product - O produto a ser exibido.
             */
            function openProductModal(product) {
                if (!productModal || !modalPrice || !modalName || !modalStock || !modalDescription || !addToCartButton || !sliderImagesContainer || !modalImageIndicators) return;
                selectedProduct = product;
                currentImageIndex = 0; // Reseta o slide ao abrir o modal

                modalPrice.textContent = `R$ ${selectedProduct.price ? selectedProduct.price.toFixed(2).replace('.', ',') : 'N/A'}`;
                modalName.textContent = selectedProduct.name || 'Produto sem nome';
                const stockStatus = getStockStatus(selectedProduct.stock);
                modalStock.className = ''; // Limpa classes anteriores
                modalStock.classList.add('stock', stockStatus.className);
                modalStock.textContent = stockStatus.text;
                modalDescription.innerHTML = selectedProduct.description ? selectedProduct.description.replace(/\n/g, '<br>') : 'Sem descrição.';

                addToCartButton.disabled = selectedProduct.stock === 0 || isNaN(selectedProduct.stock);
                addToCartButton.textContent = addToCartButton.disabled ? 'Produto Esgotado' : 'Adicionar ao Carrinho';

                // Renderiza as imagens do slider
                sliderImagesContainer.innerHTML = '';
                modalImageIndicators.innerHTML = ''; // Limpa indicadores existentes

                const imagesToDisplay = selectedProduct.images && selectedProduct.images.length > 0
                    ? selectedProduct.images
                    : ['https://via.placeholder.com/400/cccccc/ffffff?text=Sem+Imagem'];

                imagesToDisplay.forEach((imgUrl, index) => {
                    const img = document.createElement('img');
                    img.src = imgUrl;
                    img.alt = `${selectedProduct.name || 'Produto'} - Imagem ${index + 1}`;
                    sliderImagesContainer.appendChild(img);

                    if (imagesToDisplay.length > 1) {
                        const dot = document.createElement('span');
                        dot.classList.add('indicator-dot');
                        dot.dataset.index = index;
                        dot.setAttribute('aria-label', `Ir para imagem ${index + 1}`);
                        dot.addEventListener('click', () => {
                            currentImageIndex = index;
                            updateModalSlider();
                        });
                        modalImageIndicators.appendChild(dot);
                    }
                });

                updateModalSlider();

                productModal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Evita rolagem da página

                // Adiciona listeners de toque para swipe no slider do modal
                sliderImagesContainer.addEventListener('touchstart', handleTouchStart, { passive: true });
                sliderImagesContainer.addEventListener('touchmove', handleTouchMove, { passive: true });
                sliderImagesContainer.addEventListener('touchend', handleTouchEnd);
            }

            /**
             * Fecha o modal de detalhes do produto.
             */
            function closeProductModal() {
                if (!productModal) return;
                productModal.classList.remove('active');
                document.body.style.overflow = ''; // Restaura a rolagem da página
                selectedProduct = null;

                // Remove listeners de toque ao fechar o modal
                sliderImagesContainer.removeEventListener('touchstart', handleTouchStart);
                sliderImagesContainer.removeEventListener('touchmove', handleTouchMove);
                sliderImagesContainer.removeEventListener('touchend', handleTouchEnd);
            }

            /**
             * Atualiza a exibição do slider de imagens no modal.
             */
            function updateModalSlider() {
                if (!sliderImagesContainer || !modalPrevBtn || !modalNextBtn || !modalImageIndicators || !selectedProduct) return;

                const images = selectedProduct.images && selectedProduct.images.length > 0 ? selectedProduct.images : [];
                const totalImages = images.length || 1; // Considera placeholder se não houver imagens

                const offset = -currentImageIndex * 100;
                sliderImagesContainer.style.transform = `translateX(${offset}%)`;

                modalPrevBtn.disabled = currentImageIndex === 0;
                modalNextBtn.disabled = currentImageIndex === totalImages - 1;

                // Esconde botões se houver apenas 1 imagem ou nenhuma
                if (totalImages <= 1) {
                    modalPrevBtn.style.display = 'none';
                    modalNextBtn.style.display = 'none';
                    modalImageIndicators.style.display = 'none';
                } else {
                    modalPrevBtn.style.display = 'block';
                    modalNextBtn.style.display = 'block';
                    modalImageIndicators.style.display = 'flex';
                }

                const dots = modalImageIndicators.querySelectorAll('.indicator-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentImageIndex);
                });
            }
            /**
             * Abre o modal do carrinho.
             */
            function openCartModal() {
                if (!cartModal) return;
                renderCart();
                cartModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            /**
             * Fecha o modal do carrinho.
             */
            function closeCartModal() {
                if (!cartModal) return;
                cartModal.classList.remove('active');
                document.body.style.overflow = '';
            }

            // --- Funções de Swipe para o Carrossel do Modal ---

            function handleTouchStart(event) { // event já era passado implicitamente
                touchStartX = event.changedTouches[0].screenX;
            }

            function handleTouchMove(event) { // event já era passado implicitamente
                touchEndX = event.changedTouches[0].screenX;
            }

            function handleTouchEnd(event) { // Adicionado o parâmetro 'event'
                if (!selectedProduct || !selectedProduct.images || selectedProduct.images.length <= 1) {
                    touchStartX = 0; // Garante reset mesmo se não houver ação
                    touchEndX = 0;   // Garante reset mesmo se não houver ação
                    return; // Não faz nada se não houver imagens suficientes para swipe
                }

                const finalTouchEndX = event.changedTouches[0].screenX; // Usa a coordenada do evento touchend
                const totalImages = (selectedProduct.images && selectedProduct.images.length > 0 ? selectedProduct.images.length : 1);

                if (finalTouchEndX < touchStartX - swipeThreshold) { // Usa finalTouchEndX
                    // Swipe para a esquerda (próxima imagem)
                    if (currentImageIndex < totalImages - 1) {
                        currentImageIndex++;
                        updateModalSlider();
                    }
                } else if (finalTouchEndX > touchStartX + swipeThreshold) { // Usa finalTouchEndX
                    // Swipe para a direita (imagem anterior)
                    if (currentImageIndex > 0) {
                        currentImageIndex--;
                        updateModalSlider();
                    }
                }
                // Reseta as posições para o próximo toque
                touchStartX = 0;
                touchEndX = 0; // Reseta a variável de escopo da classe, embora finalTouchEndX seja prioritária aqui.
            }
            // --- Funções de Persistência (LocalStorage) ---

            function saveCartToLocalStorage() {
                localStorage.setItem('shoppingCart', JSON.stringify(currentCart));
            }

            function loadCartFromLocalStorage() {
                const storedCart = localStorage.getItem('shoppingCart');
                if (storedCart) {
                    try {
                        currentCart = JSON.parse(storedCart);
                        // Re-hidratar produtos
                        currentCart.forEach(item => {
                            if (item.product) {
                                if (typeof item.product.stock !== 'number') {
                                    item.product.stock = parseInt(item.product.stock, 10) || 0;
                                }
                                if (typeof item.product.price !== 'number') {
                                    item.product.price = parseFloat(item.product.price) || 0;
                                }
                            } else {
                                // Tratar caso onde o produto no item do carrinho é inválido
                                console.warn("Item inválido no carrinho:", item);
                                // Poderia remover o item aqui ou tentar recuperá-lo se tivesse uma fonte de dados mestre
                            }
                        });
                        // Filtra itens que possam ter ficado inválidos
                        currentCart = currentCart.filter(item => item.product && typeof item.product.id !== 'undefined');
                        renderCart();
                    } catch (e) {
                        console.error("Erro ao carregar carrinho do localStorage:", e);
                        localStorage.removeItem('shoppingCart'); // Limpa carrinho corrompido
                        currentCart = [];
                    }
                }
            }

            // --- Funções do Modal de Configurações ---

            function openSettingsModal() {
                if (!settingsModal) return;
                settingsModal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Evita rolagem da página
            }

            function closeSettingsModal() {
                if (!settingsModal) return;
                settingsModal.classList.remove('active');
                document.body.style.overflow = ''; // Restaura a rolagem da página
            }


            // --- Funções de Opções de Visualização (Grade/Lista) ---

            /**
             * Define o modo de visualização (grade ou lista) e atualiza a interface.
             * @param {string} mode - 'grid' ou 'list'.
             */
            function setViewMode(mode) {
                if (!productGrid || !displayGridButton || !displayListButton) return;
                currentViewMode = mode;
                productGrid.classList.remove('grid-view', 'list-view');
                productGrid.classList.add(`${mode}-view`);

                displayGridButton.classList.toggle('active', mode === 'grid');
                displayListButton.classList.toggle('active', mode === 'list');

                localStorage.setItem('viewMode', mode);

                const currentSearchTerm = searchInput ? searchInput.value.toLowerCase() : "";
                const filtered = allProducts.filter(product =>
                    product && product.name && product.name.toLowerCase().includes(currentSearchTerm) ||
                    product && product.description && product.description.toLowerCase().includes(currentSearchTerm)
                );
                renderProducts(filtered);
            }

            function loadViewMode() {
                const savedMode = localStorage.getItem('viewMode');
                if (savedMode && (savedMode === 'grid' || savedMode === 'list')) {
                    setViewMode(savedMode);
                } else {
                    setViewMode('grid'); // Padrão
                }
            }

            // --- Funções de Dark Mode ---
            function applyTheme(theme) {
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    if (darkModeToggle) darkModeToggle.checked = true;
                } else {
                    document.body.classList.remove('dark-mode');
                    if (darkModeToggle) darkModeToggle.checked = false;
                }
            }

            function loadTheme() {
                const savedTheme = localStorage.getItem('theme');
                // Define 'light' como padrão se nenhum tema estiver salvo.
                // Você pode adicionar lógica para verificar a preferência do sistema aqui, se desejar.
                // Exemplo: const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                // applyTheme(savedTheme || (prefersDark ? 'dark' : 'light'));
                applyTheme(savedTheme || 'light'); // Aplica o tema salvo ou 'light' como padrão
            }


            // --- Função de Busca de Produtos (e Parsing CSV) ---

            async function fetchProducts() {
                if (loader) loader.style.display = 'block';
                if (productGrid) productGrid.innerHTML = '';

                const googleSheetCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRY00iz3q4UEcZ0BUpYJ52EnLyKpAv2r37_UUS01aqb2GF1hWpxKEcmUYC1RslP-Kp-dUuJd_wTb2uq/pub?output=csv';

                try {
                    const response = await fetch(googleSheetCsvUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.text();
                    allProducts = parseCSV(data);
                    renderProducts(allProducts);
                } catch (error) {
                    console.error('Falha ao buscar produtos:', error);
                    showToast('Erro ao carregar produtos. Verifique o link e as permissões da planilha.', 'error');
                    if (productGrid) productGrid.innerHTML = '<p>Não foi possível carregar os produtos.</p>';
                } finally {
                    if (loader) loader.style.display = 'none';
                }
            }

            /**
             * Parsea um texto CSV em um array de objetos produto.
             * Considera vírgulas dentro de aspas duplas.
             * @param {string} text - O conteúdo CSV.
             * @returns {Array<Object>} Array de objetos produto.
             */
            function parseCSV(text) {
                const rows = text.split(/\r?\n/).slice(1); // Ignora o cabeçalho
                return rows.map((row, index) => {
                    const values = [];
                    let inQuote = false;
                    let currentField = "";
                    for (let i = 0; i < row.length; i++) {
                        const char = row[i];
                        if (char === '"') {
                            inQuote = !inQuote;
                        } else if (char === ',' && !inQuote) {
                            values.push(currentField.trim());
                            currentField = "";
                        } else {
                            currentField += char;
                        }
                    }
                    values.push(currentField.trim());

                    if (values.length < 5 || values[0].trim() === '') return null;

                    const priceString = values[2].replace(',', '.');
                    const stockString = values[3];

                    return {
                        id: `product-${Date.now()}-${index}-${Math.random().toString(36).substr(2, 5)}`,
                        name: values[0],
                        description: values[1],
                        price: parseFloat(priceString) || 0,
                        stock: parseInt(stockString, 10) || 0,
                        images: values[4] ? values[4].split(',').map(url => url.trim()).filter(url => url) : []
                    };
                }).filter(Boolean);
            }

            // --- Escutadores de Eventos ---

            if (searchInput) {
                searchInput.addEventListener('input', () => {
                    const term = searchInput.value.toLowerCase();
                    const filtered = allProducts.filter(product =>
                        product.name.toLowerCase().includes(term) ||
                        (product.description && product.description.toLowerCase().includes(term))
                    );
                    renderProducts(filtered);
                });
            }

            if (closeProductModalBtn) closeProductModalBtn.addEventListener('click', closeProductModal);
            if (productModal) {
                productModal.addEventListener('click', (e) => {
                    if (e.target === productModal) closeProductModal();
                });
            }

            if (modalPrevBtn) {
                modalPrevBtn.addEventListener('click', () => {
                    if (currentImageIndex > 0) {
                        currentImageIndex--;
                        updateModalSlider();
                    }
                });
            }
            if (modalNextBtn) {
                modalNextBtn.addEventListener('click', () => {
                    const images = selectedProduct && selectedProduct.images && selectedProduct.images.length > 0 ? selectedProduct.images : [];
                    const totalImages = images.length || 1;
                    if (currentImageIndex < totalImages - 1) {
                        currentImageIndex++;
                        updateModalSlider();
                    }
                });
            }

            if (addToCartButton) {
                addToCartButton.addEventListener('click', () => {
                    if (selectedProduct) {
                        addItemToCart(selectedProduct);
                        // closeProductModal(); // Opcional: fechar modal após adicionar
                    }
                });
            }

            if (animatedCartIcon) animatedCartIcon.addEventListener('click', openCartModal);
            if (closeCartModalBtn) closeCartModalBtn.addEventListener('click', closeCartModal);
            if (cartModal) {
                cartModal.addEventListener('click', (e) => {
                    if (e.target === cartModal) closeCartModal();
                });
            }

            if (clearCartButton) clearCartButton.addEventListener('click', clearCart);

            // Event Listeners para o Modal de Configurações
            if (settingsIcon) settingsIcon.addEventListener('click', openSettingsModal);
            if (closeSettingsModalBtn) closeSettingsModalBtn.addEventListener('click', closeSettingsModal);
            if (settingsModal) {
                settingsModal.addEventListener('click', (e) => {
                    if (e.target === settingsModal) closeSettingsModal();
                });
            }

            // Fechar modal de configurações ao clicar fora (se a sidebar foi removida)
            document.addEventListener('click', (e) => {
                // Este listener pode ser removido se o clique no overlay do modal já o fecha.
                // Se mantido, ajuste para o settingsModal e settingsIcon.
                if (settingsModal && settingsModal.classList.contains('active') &&
                    !settingsModal.querySelector('.modal-content').contains(e.target) && // Verifica se o clique não foi dentro do conteúdo do modal
                    e.target !== settingsIcon &&
                    (!settingsIcon || !settingsIcon.contains(e.target))
                ) {
                    // closeSettingsModal(); // Descomente se o clique no overlay não estiver funcionando como esperado
                }
            });

            if (displayGridButton) {
                displayGridButton.addEventListener('click', () => {
                    setViewMode('grid');
                    closeSettingsModal(); // Fecha o modal de configurações após a seleção
                });
            }
            if (displayListButton) {
                displayListButton.addEventListener('click', () => {
                    setViewMode('list');
                    closeSettingsModal(); // Fecha o modal de configurações após a seleção
                });
            }

            if (darkModeToggle) {
                darkModeToggle.addEventListener('change', (event) => {
                    const newTheme = event.target.checked ? 'dark' : 'light';
                    applyTheme(newTheme);
                    localStorage.setItem('theme', newTheme);
                    // closeSettingsModal(); // Opcional: fechar modal ao trocar tema, pode ser um pouco abrupto.
                });
            }


            // --- Inicialização ---
            loadCartFromLocalStorage();
            loadViewMode();
            loadTheme(); // Carrega o tema salvo
            fetchProducts();
        });

    </script>
</body>

</html>